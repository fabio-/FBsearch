<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

	<div id="header"><img src="FacebookSearch.png"></div>

	<h1>To Search for events in your city enter your location in the searach bar!</h1>
		
   	<div id="searchBar">
    		<input type="text" name="q" id="q"/>
            <input type="submit" class="go"â€‹ value="Press"/>
        </div>
        
		<div id="content"> </div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

<script type="text/javascript">

//Set button's color and shadow when clicking searchbar
$('#q').focus(function() {
  $('.go').css('background-color','rgb(28, 50, 102)');
  $('.go').css('box-shadow','0px 0px 10px -2px #333');
});

//Set button's color and shadow to original color when search bar is not focused
$('#q').focusout(function() {
  $('.go').css('background-color','#4c66a4');
  $('.go').css('box-shadow','0px 0px 0px 0px #333');
});


$('.go').click(function() {
	
	//removes previous searches!
	$('#content').empty();

    $('.go').val("Loading...");
	
	 
	 //request valid access token
	 var requestURL = 'https://graph.facebook.com/oauth/access_token?%20client_id=136237449885255&client_secret=9f9191c07c175024dbc495c7914625c0&%20grant_type=client_credentials';
	
	var accessToken = $.ajax({
  	url: requestURL,
  	global: false,
  	type: "POST",
  	data: "name=value",
  	dataType: "html",
  	async:false,
  	success: function(msg){ }
	} ).responseText;


	//query the Facebook graph search with input parameters and valid access token
    var url = 'https://graph.facebook.com/search?q='+ $('#q').val()+'&type=event&'+accessToken;
	
	
    $.getJSON(url, function(data) {
            obj = data.data;
            Object.keys(obj).forEach(function(key){
			
				//Jquery used to append all the events retrieved
				//TODO: REMOVE EVENTS WITH THE SAME NAME ID
				//		"NEXT" PAGES TO PUT EVENTS THAT DON'T FIT IN FIRST PAGE!
				
					var out = '<div class="multiborder">'+
										'<img align="right" src="https://graph.facebook.com/'+obj[key].id+'/picture?type=large" width="107" height="98" >'+
										'<b>'+obj[key].name+'</b>'+'<br>'+
										//'<div class="innerborder" align:right'+
										
										//'</div>'+
										'<br><img align=top src="location.png">'+"&#09"+obj[key].location+
										'<br>'+
										obj[key].timezone+
										'<br><a href=https://www.facebook.com/events/'+obj[key].id+'>event</a>';
										
                $('#content').append(out);
										
										$('#content').append('<br><br>');
										
			});
										 
										 
		
	$('#content').append('<br><br>');
	$('.go').val("Search");
    });

});


</script>
</body>
</html>